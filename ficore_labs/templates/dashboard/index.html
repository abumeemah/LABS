{% extends "base.html" %}
{% block title %}
{{ trans('dashboard_title', default='Dashboard') | escape }}
{% endblock %}
{% block content %}
<div class="container mt-5">
    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('general_bp.home') }}">{{ trans('general_home', default='Home') | escape }}</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ trans('dashboard_title', default='Dashboard') | escape }}</li>
        </ol>
    </nav>

    <!-- Page Title -->
    <div class="page-title">
        <h2>{{ trans('dashboard_title', default='Dashboard') | escape }}</h2>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message | escape }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if current_user.is_authenticated %}
        {% if current_user.role == 'admin' %}
            <p class="alert alert-info">{{ trans('admin_view_all_data', default='You are viewing all users\' data as an admin.') | escape }}</p>
        {% endif %}

        {% if not subscription_status.is_active %}
            <div class="alert alert-warning">
                {{ trans('subscription_required', default='Your trial or subscription has expired. Please subscribe to continue managing data.') | escape }}
                <a href="{{ url_for('personal_bp.subscribe') }}" class="btn btn-primary">{{ trans('subscribe_now', default='Subscribe Now') | escape }}</a>
            </div>
        {% endif %}

        <!-- Quick Actions -->
        <div class="mb-4">
            <h3>{{ trans('general_quick_actions', default='Quick Actions') | escape }}</h3>
            <div class="d-flex flex-wrap gap-2">
                {% if subscription_status.is_active %}
                    <a href="{{ url_for('creditors.add') }}" class="btn btn-primary">{{ trans('creditors_create_what_you_owe', default='Create What You Owe') | escape }}</a>
                    <a href="{{ url_for('debtors.add') }}" class="btn btn-primary">{{ trans('debtors_create_what_they_owe_you', default='Create What They Owe You') | escape }}</a>
                    <a href="{{ url_for('payments.add') }}" class="btn btn-primary">{{ trans('payments_add_money_out', default='Add Money Out') | escape }}</a>
                    <a href="{{ url_for('receipts.add') }}" class="btn btn-primary">{{ trans('receipts_add_money_in', default='Add Money In') | escape }}</a>
                    <a href="{{ url_for('funds.add') }}" class="btn btn-primary">{{ trans('funds_add_fund', default='Add Fund') | escape }}</a>
                    <a href="{{ url_for('investor_reports.view') }}" class="btn btn-primary">{{ trans('investor_reports_title', default='Investor Reports') | escape }}</a>
                    <a href="{{ url_for('forecasts.view') }}" class="btn btn-primary">{{ trans('forecasts_title', default='Financial Forecasts') | escape }}</a>
                {% endif %}
                {% if current_user.role == 'admin' %}
                    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-warning">{{ trans('admin_dashboard', default='Admin Dashboard') | escape }}</a>
                {% endif %}
            </div>
        </div>

        <!-- Business Finance Sections -->
        <div class="row g-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h3>{{ trans('creditors_what_you_owe', default='What You Owe') | escape }}</h3>
                        <small class="subtext">{{ trans('creditors_what_you_owe_subtext', default='Track your debts to others') | escape }}</small>
                        {% if recent_creditors %}
                            <table class="table table-striped mt-3">
                                <thead>
                                    <tr>
                                        <th>{{ trans('general_name', default='Name') | escape }}</th>
                                        <th>{{ trans('general_amount', default='Amount') | escape }}</th>
                                        {% if subscription_status.is_active %}
                                            <th>{{ trans('general_actions', default='Actions') | escape }}</th>
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for creditor in recent_creditors %}
                                        <tr>
                                            <td>{{ creditor.name | escape }}</td>
                                            <td>{{ creditor.amount_owed | format_currency }}</td>
                                            {% if subscription_status.is_active %}
                                                <td>
                                                    <button class="btn btn-secondary btn-sm actions-btn"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#creditorActionsModal"
                                                            data-id="{{ creditor._id }}"
                                                            data-name="{{ creditor.name }}"
                                                            data-amount="{{ creditor.amount_owed }}"
                                                            data-contact="{{ creditor.contact or '' }}"
                                                            data-date="{{ creditor.created_at | format_date }}"
                                                            data-description="{{ creditor.description or '' }}">
                                                        {{ trans('general_actions', default='Actions') | escape }}
                                                    </button>
                                                </td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p>{{ trans('creditors_no_what_you_owe', default='You don\'t owe anyone yet.') | escape }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h3>{{ trans('debtors_what_they_owe_you', default='What They Owe You') | escape }}</h3>
                        <small class="subtext">{{ trans('debtors_what_they_owe_you_subtext', default='Track debts owed to you') | escape }}</small>
                        {% if recent_debtors %}
                            <table class="table table-striped mt-3">
                                <thead>
                                    <tr>
                                        <th>{{ trans('general_name', default='Name') | escape }}</th>
                                        <th>{{ trans('general_amount', default='Amount') | escape }}</th>
                                        {% if subscription_status.is_active %}
                                            <th>{{ trans('general_actions', default='Actions') | escape }}</th>
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for debtor in recent_debtors %}
                                        <tr>
                                            <td>{{ debtor.name | escape }}</td>
                                            <td>{{ debtor.amount_owed | format_currency }}</td>
                                            {% if subscription_status.is_active %}
                                                <td>
                                                    <button class="btn btn-secondary btn-sm actions-btn"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#debtorActionsModal"
                                                            data-id="{{ debtor._id }}"
                                                            data-name="{{ debtor.name }}"
                                                            data-amount="{{ debtor.amount_owed }}"
                                                            data-contact="{{ debtor.contact or '' }}"
                                                            data-date="{{ debtor.created_at | format_date }}"
                                                            data-reminders="{{ debtor.get('reminder_count', 0) }}"
                                                            data-description="{{ debtor.description or '' }}">
                                                        {{ trans('general_actions', default='Actions') | escape }}
                                                    </button>
                                                </td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p>{{ trans('debtors_no_what_they_owe_you', default='No one owes you yet.') | escape }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h3>{{ trans('payments_money_out', default='Money Out') | escape }}</h3>
                        <small class="subtext">{{ trans('payments_money_out_subtext', default='Track your expenses and payments') | escape }}</small>
                        {% if recent_payments %}
                            <table class="table table-striped mt-3">
                                <thead>
                                    <tr>
                                        <th>{{ trans('payments_recipient', default='Recipient') | escape }}</th>
                                        <th>{{ trans('general_amount', default='Amount') | escape }}</th>
                                        {% if subscription_status.is_active %}
                                            <th>{{ trans('general_actions', default='Actions') | escape }}</th>
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for payment in recent_payments %}
                                        <tr>
                                            <td>{{ payment.recipient | escape }}</td>
                                            <td>{{ payment.amount | format_currency }}</td>
                                            {% if subscription_status.is_active %}
                                                <td>
                                                    <button class="btn btn-secondary btn-sm actions-btn"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#paymentActionsModal"
                                                            data-id="{{ payment._id }}"
                                                            data-recipient="{{ payment.recipient }}"
                                                            data-amount="{{ payment.amount }}"
                                                            data-date="{{ payment.created_at | format_date }}"
                                                            data-description="{{ payment.description or '' }}">
                                                        {{ trans('general_actions', default='Actions') | escape }}
                                                    </button>
                                                </td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p>{{ trans('payments_no_money_out', default='No money out recorded yet.') | escape }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h3>{{ trans('receipts_money_in', default='Money In') | escape }}</h3>
                        <small class="subtext">{{ trans('receipts_money_in_subtext', default='Track your income and receipts') | escape }}</small>
                        {% if recent_receipts %}
                            <table class="table table-striped mt-3">
                                <thead>
                                    <tr>
                                        <th>{{ trans('receipts_payer', default='Payer') | escape }}</th>
                                        <th>{{ trans('general_amount', default='Amount') | escape }}</th>
                                        {% if subscription_status.is_active %}
                                            <th>{{ trans('general_actions', default='Actions') | escape }}</th>
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for receipt in recent_receipts %}
                                        <tr>
                                            <td>{{ receipt.payer | escape }}</td>
                                            <td>{{ receipt.amount | format_currency }}</td>
                                            {% if subscription_status.is_active %}
                                                <td>
                                                    <button class="btn btn-secondary btn-sm actions-btn"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#receiptActionsModal"
                                                            data-id="{{ receipt._id }}"
                                                            data-payer="{{ receipt.payer }}"
                                                            data-amount="{{ receipt.amount }}"
                                                            data-date="{{ receipt.created_at | format_date }}"
                                                            data-description="{{ receipt.description or '' }}">
                                                        {{ trans('general_actions', default='Actions') | escape }}
                                                    </button>
                                                </td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p>{{ trans('receipts_no_money_in', default='No money in recorded yet.') | escape }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h3>{{ trans('funds_title', default='Funds') | escape }}</h3>
                        <small class="subtext">{{ trans('funds_subtext', default='Track your available funds') | escape }}</small>
                        {% if recent_funds %}
                            <table class="table table-striped mt-3">
                                <thead>
                                    <tr>
                                        <th>{{ trans('funds_source', default='Source') | escape }}</th>
                                        <th>{{ trans('general_amount', default='Amount') | escape }}</th>
                                        {% if subscription_status.is_active %}
                                            <th>{{ trans('general_actions', default='Actions') | escape }}</th>
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for fund in recent_funds %}
                                        <tr>
                                            <td>{{ fund.source | escape }}</td>
                                            <td>{{ fund.amount | format_currency }}</td>
                                            {% if subscription_status.is_active %}
                                                <td>
                                                    <button class="btn btn-secondary btn-sm actions-btn"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#fundActionsModal"
                                                            data-id="{{ fund._id }}"
                                                            data-source="{{ fund.source }}"
                                                            data-amount="{{ fund.amount }}"
                                                            data-date="{{ fund.created_at | format_date }}"
                                                            data-description="{{ fund.description or '' }}">
                                                        {{ trans('general_actions', default='Actions') | escape }}
                                                    </button>
                                                </td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p>{{ trans('funds_no_funds', default='No funds recorded yet.') | escape }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="text-center py-5">
            <h3>{{ trans('dashboard_welcome_to_ficore', default='Welcome to FiCore') | escape }}</h3>
            <p class="text-muted">{{ trans('dashboard_please_login', default='Please log in to view your dashboard.') | escape }}</p>
            <a href="{{ url_for('users.login') }}" class="btn btn-primary">{{ trans('general_login', default='Log In') | escape }}</a>
        </div>
    {% endif %}

    <!-- Creditor Actions Modal -->
    <div class="modal fade" id="creditorActionsModal" tabindex="-1" aria-labelledby="creditorActionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="creditorActionsModalLabel">{{ trans('creditors_what_you_owe', default='What You Owe') | escape }}</h5>
                    <button class="btn-close" data-bs-dismiss="modal" aria-label="{{ trans('general_close', default='Close') | escape }}"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_name', default='Name') | escape }}:</strong> <span id="creditorModalName"></span></p>
                            <p><strong>{{ trans('general_amount', default='Amount') | escape }}:</strong> <span id="creditorModalAmount"></span></p>
                            <p><strong>{{ trans('general_contact', default='Contact') | escape }}:</strong> <span id="creditorModalContact"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_description', default='Description') | escape }}:</strong> <span id="creditorModalDescription"></span></p>
                            <p><strong>{{ trans('general_date', default='Date') | escape }}:</strong> <span id="creditorModalDate"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a id="creditorViewBtn" class="btn btn-info" href="#">{{ trans('general_view', default='View') | escape }}</a>
                    {% if subscription_status.is_active %}
                        <a id="creditorEditBtn" class="btn btn-primary" href="#">{{ trans('general_edit', default='Edit') | escape }}</a>
                        <form id="creditorDeleteForm" action="#" method="POST" style="display:inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('{{ trans('general_confirm_delete', default='Are you sure?') | escape }}')">
                                {{ trans('general_delete', default='Delete') | escape }}
                            </button>
                        </form>
                    {% endif %}
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ trans('general_close', default='Close') | escape }}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Debtor Actions Modal -->
    <div class="modal fade" id="debtorActionsModal" tabindex="-1" aria-labelledby="debtorActionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="debtorActionsModalLabel">{{ trans('debtors_what_they_owe_you', default='What They Owe You') | escape }}</h5>
                    <button class="btn-close" data-bs-dismiss="modal" aria-label="{{ trans('general_close', default='Close') | escape }}"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_name', default='Name') | escape }}:</strong> <span id="debtorModalName"></span></p>
                            <p><strong>{{ trans('general_amount', default='Amount') | escape }}:</strong> <span id="debtorModalAmount"></span></p>
                            <p><strong>{{ trans('general_contact', default='Contact') | escape }}:</strong> <span id="debtorModalContact"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_description', default='Description') | escape }}:</strong> <span id="debtorModalDescription"></span></p>
                            <p><strong>{{ trans('general_date', default='Date') | escape }}:</strong> <span id="debtorModalDate"></span></p>
                            <p><strong>{{ trans('debtors_reminders', default='Reminders') | escape }}:</strong> <span id="debtorModalReminders"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a id="debtorViewBtn" class="btn btn-info" href="#">{{ trans('general_view', default='View') | escape }}</a>
                    {% if subscription_status.is_active %}
                        <a id="debtorEditBtn" class="btn btn-primary" href="#">{{ trans('general_edit', default='Edit') | escape }}</a>
                        <form id="debtorDeleteForm" action="#" method="POST" style="display:inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('{{ trans('general_confirm_delete', default='Are you sure?') | escape }}')">
                                {{ trans('general_delete', default='Delete') | escape }}
                            </button>
                        </form>
                    {% endif %}
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ trans('general_close', default='Close') | escape }}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Actions Modal -->
    <div class="modal fade" id="paymentActionsModal" tabindex="-1" aria-labelledby="paymentActionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentActionsModalLabel">{{ trans('payments_money_out', default='Money Out') | escape }}</h5>
                    <button class="btn-close" data-bs-dismiss="modal" aria-label="{{ trans('general_close', default='Close') | escape }}"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{{ trans('payments_recipient', default='Recipient') | escape }}:</strong> <span id="paymentModalRecipient"></span></p>
                            <p><strong>{{ trans('general_amount', default='Amount') | escape }}:</strong> <span id="paymentModalAmount"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_description', default='Description') | escape }}:</strong> <span id="paymentModalDescription"></span></p>
                            <p><strong>{{ trans('general_date', default='Date') | escape }}:</strong> <span id="paymentModalDate"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a id="paymentViewBtn" class="btn btn-info" href="#">{{ trans('general_view', default='View') | escape }}</a>
                    {% if subscription_status.is_active %}
                        <a id="paymentEditBtn" class="btn btn-primary" href="#">{{ trans('general_edit', default='Edit') | escape }}</a>
                        <form id="paymentDeleteForm" action="#" method="POST" style="display:inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('{{ trans('general_confirm_delete', default='Are you sure?') | escape }}')">
                                {{ trans('general_delete', default='Delete') | escape }}
                            </button>
                        </form>
                    {% endif %}
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ trans('general_close', default='Close') | escape }}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Receipt Actions Modal -->
    <div class="modal fade" id="receiptActionsModal" tabindex="-1" aria-labelledby="receiptActionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="receiptActionsModalLabel">{{ trans('receipts_money_in', default='Money In') | escape }}</h5>
                    <button class="btn-close" data-bs-dismiss="modal" aria-label="{{ trans('general_close', default='Close') | escape }}"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{{ trans('receipts_payer', default='Payer') | escape }}:</strong> <span id="receiptModalPayer"></span></p>
                            <p><strong>{{ trans('general_amount', default='Amount') | escape }}:</strong> <span id="receiptModalAmount"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_description', default='Description') | escape }}:</strong> <span id="receiptModalDescription"></span></p>
                            <p><strong>{{ trans('general_date', default='Date') | escape }}:</strong> <span id="receiptModalDate"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a id="receiptViewBtn" class="btn btn-info" href="#">{{ trans('general_view', default='View') | escape }}</a>
                    {% if subscription_status.is_active %}
                        <a id="receiptEditBtn" class="btn btn-primary" href="#">{{ trans('general_edit', default='Edit') | escape }}</a>
                        <form id="receiptDeleteForm" action="#" method="POST" style="display:inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('{{ trans('general_confirm_delete', default='Are you sure?') | escape }}')">
                                {{ trans('general_delete', default='Delete') | escape }}
                            </button>
                        </form>
                    {% endif %}
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ trans('general_close', default='Close') | escape }}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Fund Actions Modal -->
    <div class="modal fade" id="fundActionsModal" tabindex="-1" aria-labelledby="fundActionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="fundActionsModalLabel">{{ trans('funds_title', default='Funds') | escape }}</h5>
                    <button class="btn-close" data-bs-dismiss="modal" aria-label="{{ trans('general_close', default='Close') | escape }}"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{{ trans('funds_source', default='Source') | escape }}:</strong> <span id="fundModalSource"></span></p>
                            <p><strong>{{ trans('general_amount', default='Amount') | escape }}:</strong> <span id="fundModalAmount"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_description', default='Description') | escape }}:</strong> <span id="fundModalDescription"></span></p>
                            <p><strong>{{ trans('general_date', default='Date') | escape }}:</strong> <span id="fundModalDate"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a id="fundViewBtn" class="btn btn-info" href="#">{{ trans('general_view', default='View') | escape }}</a>
                    {% if subscription_status.is_active %}
                        <a id="fundEditBtn" class="btn btn-primary" href="#">{{ trans('general_edit', default='Edit') | escape }}</a>
                        <form id="fundDeleteForm" action="#" method="POST" style="display:inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('{{ trans('general_confirm_delete', default='Are you sure?') | escape }}')">
                                {{ trans('general_delete', default='Delete') | escape }}
                            </button>
                        </form>
                    {% endif %}
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ trans('general_close', default='Close') | escape }}</button>
                </div>
            </div>
        </div>
    </div>
</div>

{% block page_scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Initialize tooltips
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    tooltipTriggerList.forEach(el => new bootstrap.Tooltip(el));

    let currentData = null;

    // Creditor Actions
    document.querySelectorAll('#creditorActionsModal').forEach(modal => {
        modal.addEventListener('show.bs.modal', (event) => {
            const button = event.relatedTarget;
            currentData = {
                _id: button.dataset.id,
                name: button.dataset.name,
                amount: parseFloat(button.dataset.amount).toLocaleString(),
                contact: button.dataset.contact,
                date: button.dataset.date,
                description: button.dataset.description
            };

            // Populate modal
            document.getElementById('creditorModalName').textContent = currentData.name;
            document.getElementById('creditorModalAmount').textContent = `{{ trans('general_currency_symbol', default='₦') | escape }}${currentData.amount}`;
            document.getElementById('creditorModalContact').textContent = currentData.contact || '-';
            document.getElementById('creditorModalDescription').textContent = currentData.description || '-';
            document.getElementById('creditorModalDate').textContent = currentData.date;

            // Update action buttons
            document.getElementById('creditorViewBtn').href = `/creditors/view/${currentData._id}`;
            {% if subscription_status.is_active %}
                document.getElementById('creditorEditBtn').href = `/creditors/edit/${currentData._id}`;
                document.getElementById('creditorDeleteForm').action = `/creditors/delete/${currentData._id}`;
            {% endif %}
        });
    });

    // Debtor Actions
    document.querySelectorAll('#debtorActionsModal').forEach(modal => {
        modal.addEventListener('show.bs.modal', (event) => {
            const button = event.relatedTarget;
            currentData = {
                _id: button.dataset.id,
                name: button.dataset.name,
                amount: parseFloat(button.dataset.amount).toLocaleString(),
                contact: button.dataset.contact,
                date: button.dataset.date,
                reminders: button.dataset.reminders,
                description: button.dataset.description
            };

            // Populate modal
            document.getElementById('debtorModalName').textContent = currentData.name;
            document.getElementById('debtorModalAmount').textContent = `{{ trans('general_currency_symbol', default='₦') | escape }}${currentData.amount}`;
            document.getElementById('debtorModalContact').textContent = currentData.contact || '-';
            document.getElementById('debtorModalDescription').textContent = currentData.description || '-';
            document.getElementById('debtorModalDate').textContent = currentData.date;
            document.getElementById('debtorModalReminders').textContent = currentData.reminders;

            // Update action buttons
            document.getElementById('debtorViewBtn').href = `/debtors/view/${currentData._id}`;
            {% if subscription_status.is_active %}
                document.getElementById('debtorEditBtn').href = `/debtors/edit/${currentData._id}`;
                document.getElementById('debtorDeleteForm').action = `/debtors/delete/${currentData._id}`;
            {% endif %}
        });
    });

    // Payment Actions
    document.querySelectorAll('#paymentActionsModal').forEach(modal => {
        modal.addEventListener('show.bs.modal', (event) => {
            const button = event.relatedTarget;
            currentData = {
                _id: button.dataset.id,
                recipient: button.dataset.recipient,
                amount: parseFloat(button.dataset.amount).toLocaleString(),
                date: button.dataset.date,
                description: button.dataset.description
            };

            // Populate modal
            document.getElementById('paymentModalRecipient').textContent = currentData.recipient;
            document.getElementById('paymentModalAmount').textContent = `{{ trans('general_currency_symbol', default='₦') | escape }}${currentData.amount}`;
            document.getElementById('paymentModalDescription').textContent = currentData.description || '-';
            document.getElementById('paymentModalDate').textContent = currentData.date;

            // Update action buttons
            document.getElementById('paymentViewBtn').href = `/payments/view/${currentData._id}`;
            {% if subscription_status.is_active %}
                document.getElementById('paymentEditBtn').href = `/payments/edit/${currentData._id}`;
                document.getElementById('paymentDeleteForm').action = `/payments/delete/${currentData._id}`;
            {% endif %}
        });
    });

    // Receipt Actions
    document.querySelectorAll('#receiptActionsModal').forEach(modal => {
        modal.addEventListener('show.bs.modal', (event) => {
            const button = event.relatedTarget;
            currentData = {
                _id: button.dataset.id,
                payer: button.dataset.payer,
                amount: parseFloat(button.dataset.amount).toLocaleString(),
                date: button.dataset.date,
                description: button.dataset.description
            };

            // Populate modal
            document.getElementById('receiptModalPayer').textContent = currentData.payer;
            document.getElementById('receiptModalAmount').textContent = `{{ trans('general_currency_symbol', default='₦') | escape }}${currentData.amount}`;
            document.getElementById('receiptModalDescription').textContent = currentData.description || '-';
            document.getElementById('receiptModalDate').textContent = currentData.date;

            // Update action buttons
            document.getElementById('receiptViewBtn').href = `/receipts/view/${currentData._id}`;
            {% if subscription_status.is_active %}
                document.getElementById('receiptEditBtn').href = `/receipts/edit/${currentData._id}`;
                document.getElementById('receiptDeleteForm').action = `/receipts/delete/${currentData._id}`;
            {% endif %}
        });
    });

    // Fund Actions
    document.querySelectorAll('#fundActionsModal').forEach(modal => {
        modal.addEventListener('show.bs.modal', (event) => {
            const button = event.relatedTarget;
            currentData = {
                _id: button.dataset.id,
                source: button.dataset.source,
                amount: parseFloat(button.dataset.amount).toLocaleString(),
                date: button.dataset.date,
                description: button.dataset.description
            };

            // Populate modal
            document.getElementById('fundModalSource').textContent = currentData.source;
            document.getElementById('fundModalAmount').textContent = `{{ trans('general_currency_symbol', default='₦') | escape }}${currentData.amount}`;
            document.getElementById('fundModalDescription').textContent = currentData.description || '-';
            document.getElementById('fundModalDate').textContent = currentData.date;

            // Update action buttons
            document.getElementById('fundViewBtn').href = `/funds/view/${currentData._id}`;
            {% if subscription_status.is_active %}
                document.getElementById('fundEditBtn').href = `/funds/edit/${currentData._id}`;
                document.getElementById('fundDeleteForm').action = `/funds/delete/${currentData._id}`;
            {% endif %}
        });
    });
});
</script>
{% endblock %}
